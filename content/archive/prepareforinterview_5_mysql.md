+++
title = "5天八股"
date = 2025-04-29T08:57:36+08:00
draft = false
description = ""
subtitle = "存储篇之Mysql"
header_img = ""
short = false
toc = true
tags = []
categories = ["计算机"]
series = ["面试"]
comment = false
summary = ""
+++

> 费曼学习法：学习->教学->纠错学习->简化教学


# 1. MySQL 基础

# 2. 索引与优化

# 3. 事务与隔离级别

# 4.锁机制详细总结

## 1. 锁的分类与本质

### 1.1 按粒度划分

- **表级锁（Table Lock）**
  - 锁定整张表。
  - 开销小，加锁快，但并发度低。
  - 典型场景：DDL操作、MyISAM引擎默认使用。

- **行级锁（Row Lock）**
  - 锁定某一行记录。
  - 开销大，加锁慢，但并发度高。
  - 典型场景：InnoDB引擎支持的精细控制。

- **页面锁（Page Lock）**（MySQL基本不用）
  - 锁定一定范围的数据页（较细粒度，不如行锁灵活）。

### 1.2 按操作划分

- **共享锁（S Lock）**
  - 读锁，允许多个事务同时读取数据，但不能修改。

- **排他锁（X Lock）**
  - 写锁，事务独占数据，阻止其他事务读取和修改。

### 1.3 按使用方式划分

- **隐式锁**
  - InnoDB自动在需要时加锁。

- **显式锁**
  - 通过 `SELECT ... FOR UPDATE` 或 `LOCK TABLES` 语句手动加锁。


## 2. InnoDB锁的细节分类

### 2.1 意向锁（Intent Lock）

- 说明：表级锁，标识事务将要对某些行加锁。
- 作用：提高表锁和行锁兼容性检查的效率。
- 类型：意向共享锁（IS）、意向排他锁（IX）。

### 2.2 行锁（Record Lock）

- 锁定单条记录，不影响其他行。

### 2.3 间隙锁（Gap Lock）

- 锁定一个范围（不包括已有数据）。
- 作用：防止幻读。
- 典型场景：`SELECT * FROM t WHERE id BETWEEN 10 AND 20 FOR UPDATE`

### 2.4 临键锁（Next-Key Lock）

- 行锁 + 间隙锁的结合。
- 锁定当前记录+前面的间隙。
- InnoDB的默认策略，在可重复读（RR）隔离级别下防止幻读。


## 3. 乐观锁与悲观锁

### 3.1 乐观锁（Optimistic Lock）

- 不加锁，依赖版本号（Version）或时间戳（Timestamp）机制控制并发。
- 典型实现：更新时检查版本号是否变化。
- 应用场景：冲突少的业务，例如用户浏览记录更新。

### 3.2 悲观锁（Pessimistic Lock）

- 认为冲突频繁，操作前必须加锁防止并发修改。
- 应用场景：库存扣减，金融交易等强一致性场景。

> InnoDB默认使用的是悲观锁机制，通过行锁控制并发修改，但配合MVCC支持快照读（无需加锁的读取）。


## 4. 锁的加锁与解锁

- 加锁：由存储引擎根据SQL类型和隔离级别自动加锁，也可以手动显式加锁。
- 解锁：事务提交（COMMIT）或回滚（ROLLBACK）时释放锁。
- 特殊情况：DML过程中事务失败也可能提前释放部分锁。


## 5. 死锁（Deadlock）分析

- 定义：多个事务相互持有对方需要的锁资源，形成循环等待。
- 常见原因：
  - 事务加锁顺序不一致。
  - 范围更新导致大量锁竞争。

- 解决策略：
  - 控制事务加锁顺序统一。
  - 小事务优先执行，快速释放锁。
  - InnoDB支持自动检测死锁并回滚代价小的事务。

- 检查方式：
  ```sql
  SHOW ENGINE INNODB STATUS;
  ```
  查看最新死锁信息。


## 锁部分常见面试问题总结

| 面试问题 | 答案要点 |
| :--- | :--- |
| InnoDB支持哪些类型的锁？ | 表锁、行锁（记录锁、间隙锁、临键锁）、意向锁。 |
| 意向锁的作用是什么？ | 优化表级锁与行级锁之间的冲突检测，提高加锁效率。 |
| 什么是Next-Key Lock？ | 临键锁=记录锁+间隙锁，用于防止幻读。 |
| MVCC与锁有什么关系？ | MVCC允许读操作不加锁，通过ReadView与Undo Log实现一致性读。 |
| 乐观锁与悲观锁有什么区别？ | 乐观锁基于版本检测避免冲突，悲观锁通过加锁机制防止冲突。应用场景不同。 |
| 死锁如何排查？ | 使用`SHOW ENGINE INNODB STATUS`，查看死锁发生的事务与资源占用。 |

---

> 这一份内容可以作为面试前复习【锁】专题的资料，兼具广度与深度。
> 如果需要，我可以继续为你整理下一部分，比如：事务与隔离级别深入总结。


# 5. MySQL 日志

# 6. 主从复制与高可用

# 7. 常见面试问题

# 8. MySQL 性能优化





